<!DOCTYPE html>
<html>
<head>
    <title>Master Cost Lists</title>
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; padding: 30px; background-color: #f5f5f5; }
        .container { max-width: 1400px; margin: 0 auto; background-color: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        h1 { font-size: 32px; margin-bottom: 10px; color: #333; }
        .subtitle { color: #666; margin-bottom: 30px; font-size: 14px; }
        h2 { font-size: 24px; margin-top: 40px; margin-bottom: 15px; color: #333; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        thead { background-color: #e8f4f8; }
        .notions thead { background-color: #f3e8f8; }
        .labor thead { background-color: #fef3e8; }
        .cleaning thead { background-color: #e8f8f0; }
        .vendors thead { background-color: #ffe8e8; }
        th { text-align: left; padding: 12px; font-weight: 600; color: #333; border: 1px solid #ddd; }
        td { padding: 12px; border: 1px solid #ddd; }
        tbody tr:hover { background-color: #f9f9f9; }
        .btn { padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; margin-right: 5px; transition: all 0.2s; }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-primary:hover { background-color: #0056b3; }
        .btn-success { background-color: #28a745; color: white; }
        .btn-success:hover { background-color: #218838; }
        .btn-danger { background-color: #dc3545; color: white; }
        .btn-danger:hover { background-color: #c82333; }
        .btn-secondary { background-color: #6c757d; color: white; text-decoration: none; display: inline-block; }
        .btn-secondary:hover { background-color: #545b62; }
        .btn-small { padding: 4px 8px; font-size: 12px; }
        .actions { display: flex; gap: 5px; }
        .add-row-btn { margin: 10px 0 20px 0; }
        input, select { width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }
        input:focus, select:focus { outline: none; border-color: #007bff; box-shadow: 0 0 0 2px rgba(0,123,255,0.1); }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1000; }
        .modal-content { background-color: white; margin: 100px auto; padding: 30px; width: 500px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .modal-header { margin-bottom: 20px; }
        .modal-header h3 { margin: 0; color: #333; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; color: #555; }
        .modal-footer { margin-top: 20px; text-align: right; }
        .notification { position: fixed; top: 20px; right: 20px; padding: 15px 20px; border-radius: 4px; color: white; display: none; z-index: 2000; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
        .notification.success { background-color: #28a745; }
        .notification.error { background-color: #dc3545; }
        .back-button { margin-top: 40px; }
        .warning-box { background-color: #fff3cd; border: 1px solid #ffeaa7; color: #856404; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
        .vendor-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 40px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Master Cost Lists</h1>
        <p class="subtitle">These costs apply to ALL styles. When you update a price here, it automatically updates all styles that use this item.</p>
        
        <div class="warning-box">
            <strong>‚ö†Ô∏è Important:</strong> Changes to master costs will immediately affect the pricing of all existing uniform styles in your system.
        </div>
        
        <!-- VENDORS SECTION -->
        <h2>Vendors</h2>
        <div class="vendor-grid">
            <!-- FABRIC VENDORS -->
            <div id="fabric-vendors">
                <h3>Fabric Vendors</h3>
                <button class="btn btn-success add-row-btn btn-add-modal" data-type="fabric_vendor">+ Add Fabric Vendor</button>
                <table class="vendors">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Code</th>
                            <th style="width: 120px;">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for vendor in fabric_vendors %}
                        <tr>
                            <td>{{ vendor.name }}</td>
                            <td>{{ vendor.vendor_code or '' }}</td>
                            <td>
                                <div class="actions">
                                    <button class="btn btn-primary btn-small btn-edit" data-type="fabric_vendor" data-id="{{ vendor.id }}">Edit</button>
                                    <button class="btn btn-danger btn-small btn-delete" data-type="fabric_vendor" data-id="{{ vendor.id }}">Delete</button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            <!-- NOTION VENDORS -->
            <div id="notion-vendors">
                <h3>Notion Vendors</h3>
                <button class="btn btn-success add-row-btn btn-add-modal" data-type="notion_vendor">+ Add Notion Vendor</button>
                <table class="vendors">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Code</th>
                            <th style="width: 120px;">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for vendor in notion_vendors %}
                        <tr>
                            <td>{{ vendor.name }}</td>
                            <td>{{ vendor.vendor_code or '' }}</td>
                            <td>
                                <div class="actions">
                                    <button class="btn btn-primary btn-small btn-edit" data-type="notion_vendor" data-id="{{ vendor.id }}">Edit</button>
                                    <button class="btn btn-danger btn-small btn-delete" data-type="notion_vendor" data-id="{{ vendor.id }}">Delete</button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- FABRICS -->
        <h2>Fabrics</h2>
        <div style="margin-bottom: 15px;">
            <input type="text" id="fabricSearch" placeholder="üîç Search fabrics..." style="width: 300px; padding: 8px; margin-bottom: 10px;">
            <span id="fabricCount" style="margin-left: 15px; color: #666;"></span>
        </div>
        <button class="btn btn-success add-row-btn btn-add-modal" data-type="fabric">+ Add Fabric</button>
        <table class="fabrics">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Code</th>
                    <th>Cost/Yard</th>
                    <th>Vendor</th>
                    <th style="width: 150px;">Actions</th>
                </tr>
            </thead>
            <tbody id="fabricsTable">
                {% for fabric in fabrics %}
                <tr data-id="{{ fabric.id }}" class="fabric-row">
                    <td>{{ fabric.name }}</td>
                    <td>{{ fabric.fabric_code or '' }}</td>
                    <td>${{ "%.2f"|format(fabric.cost_per_yard) }}</td>
                    <td>{{ fabric.fabric_vendor.name if fabric.fabric_vendor else 'N/A' }}</td>
                    <td>
                        <div class="actions">
                            <button class="btn btn-primary btn-small btn-edit" data-type="fabric" data-id="{{ fabric.id }}">Edit</button>
                            <button class="btn btn-danger btn-small btn-delete" data-type="fabric" data-id="{{ fabric.id }}">Delete</button>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
        <!-- NOTIONS -->
        <h2>Notions</h2>
        <div style="margin-bottom: 15px;">
            <input type="text" id="notionSearch" placeholder="üîç Search notions..." style="width: 300px; padding: 8px; margin-bottom: 10px;">
            <span id="notionCount" style="margin-left: 15px; color: #666;"></span>
        </div>
        <button class="btn btn-success add-row-btn btn-add-modal" data-type="notion">+ Add Notion</button>
        <table class="notions">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Cost/Unit</th>
                    <th>Vendor</th>
                    <th style="width: 150px;">Actions</th>
                </tr>
            </thead>
            <tbody id="notionsTable">
                {% for notion in notions %}
                <tr data-id="{{ notion.id }}" class="notion-row">
                    <td>{{ notion.name }}</td>
                    <td>${{ "%.2f"|format(notion.cost_per_unit) }}</td>
                    <td>{{ notion.notion_vendor.name if notion.notion_vendor else 'N/A' }}</td>
                    <td>
                        <div class="actions">
                            <button class="btn btn-primary btn-small btn-edit" data-type="notion" data-id="{{ notion.id }}">Edit</button>
                            <button class="btn btn-danger btn-small btn-delete" data-type="notion" data-id="{{ notion.id }}">Delete</button>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
        <!-- LABOR -->
        <h2>Labor Operations</h2>
        <div style="margin-bottom: 15px;">
            <input type="text" id="laborSearch" placeholder="üîç Search labor operations..." style="width: 300px; padding: 8px; margin-bottom: 10px;">
            <span id="laborCount" style="margin-left: 15px; color: #666;"></span>
        </div>
        <button class="btn btn-success add-row-btn btn-add-modal" data-type="labor">+ Add Labor Operation</button>
        <table class="labor">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Cost Type</th>
                    <th>Rate</th>
                    <th style="width: 150px;">Actions</th>
                </tr>
            </thead>
            <tbody id="laborTable">
                {% for labor in labor_costs %}
                <tr data-id="{{ labor.id }}" class="labor-row">
                    <td>{{ labor.name }}</td>
                    <td>{{ labor.cost_type or 'flat_rate' }}</td>
                    <td>
                        {% if labor.cost_type == 'flat_rate' %}
                            ${{ "%.2f"|format(labor.fixed_cost or 0) }}
                        {% elif labor.cost_type == 'hourly' %}
                            ${{ "%.2f"|format(labor.cost_per_hour or 0) }}/hr
                        {% elif labor.cost_type == 'per_piece' %}
                            ${{ "%.2f"|format(labor.cost_per_piece or 0) }}/pc
                        {% else %}
                            N/A
                        {% endif %}
                    </td>
                    <td>
                        <div class="actions">
                            <button class="btn btn-primary btn-small btn-edit" data-type="labor" data-id="{{ labor.id }}">Edit</button>
                            <button class="btn btn-danger btn-small btn-delete" data-type="labor" data-id="{{ labor.id }}">Delete</button>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
        <!-- CLEANING -->
        <h2>Cleaning Costs</h2>
        <div style="margin-bottom: 15px;">
            <input type="text" id="cleaningSearch" placeholder="üîç Search cleaning costs..." style="width: 300px; padding: 8px; margin-bottom: 10px;">
            <span id="cleaningCount" style="margin-left: 15px; color: #666;"></span>
        </div>
        <button class="btn btn-success add-row-btn btn-add-modal" data-type="cleaning">+ Add Cleaning Cost</button>
        <table class="cleaning">
            <thead>
                <tr>
                    <th>Type</th>
                    <th>Cost</th>
                    <th style="width: 150px;">Actions</th>
                </tr>
            </thead>
            <tbody id="cleaningTable">
                {% for cleaning in cleaning_costs %}
                <tr data-id="{{ cleaning.id }}" class="cleaning-row">
                    <td>{{ cleaning.garment_type }}</td>
                    <td>${{ "%.2f"|format(cleaning.fixed_cost) }}</td>
                    <td>
                        <div class="actions">
                            <button class="btn btn-primary btn-small btn-edit" data-type="cleaning" data-id="{{ cleaning.id }}">Edit</button>
                            <button class="btn btn-danger btn-small btn-delete" data-type="cleaning" data-id="{{ cleaning.id }}">Delete</button>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- COLORS -->
        <h2>Colors</h2>
        <div style="margin-bottom: 15px;">
            <input type="text" id="colorSearch" placeholder="üîç Search colors..." style="width: 300px; padding: 8px; margin-bottom: 10px;">
            <span id="colorCount" style="margin-left: 15px; color: #666;"></span>
        </div>
        <button class="btn btn-success add-row-btn btn-add-modal" data-type="color">+ Add Color</button>
        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th style="width: 150px;">Actions</th>
                </tr>
            </thead>
            <tbody id="colorsTable">
                {% for color in colors %}
                <tr data-id="{{ color.id }}" class="color-row">
                    <td>{{ color.name }}</td>
                    <td>
                        <div class="actions">
                            <button class="btn btn-primary btn-small btn-edit" data-type="color" data-id="{{ color.id }}">Edit</button>
                            <button class="btn btn-danger btn-small btn-delete" data-type="color" data-id="{{ color.id }}">Delete</button>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- VARIABLES -->
        <h2>Variables</h2>
        <div style="margin-bottom: 15px;">
            <input type="text" id="variableSearch" placeholder="üîç Search variables..." style="width: 300px; padding: 8px; margin-bottom: 10px;">
            <span id="variableCount" style="margin-left: 15px; color: #666;"></span>
        </div>
        <button class="btn btn-success add-row-btn btn-add-modal" data-type="variable">+ Add Variable</button>
        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th style="width: 150px;">Actions</th>
                </tr>
            </thead>
            <tbody id="variablesTable">
                {% for variable in variables %}
                <tr data-id="{{ variable.id }}" class="variable-row">
                    <td>{{ variable.name }}</td>
                    <td>
                        <div class="actions">
                            <button class="btn btn-primary btn-small btn-edit" data-type="variable" data-id="{{ variable.id }}">Edit</button>
                            <button class="btn btn-danger btn-small btn-delete" data-type="variable" data-id="{{ variable.id }}">Delete</button>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
         <!-- SIZE RANGES -->
        <h2>Size Ranges</h2>
        <div style="margin-bottom: 15px;">
            <input type="text" id="sizeRangeSearch" placeholder="üîç Search size ranges..." style="width: 300px; padding: 8px; margin-bottom: 10px;">
            <span id="sizeRangeCount" style="margin-left: 15px; color: #666;"></span>
        </div>
        <button class="btn btn-success add-row-btn btn-add-modal" data-type="size_range">+ Add Size Range</button>
        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Regular Sizes</th>
                    <th>Extended Sizes</th>
                    <th>Extended Markup %</th>
                    <th>Description</th>
                    <th style="width: 150px;">Actions</th>
                </tr>
            </thead>
            <tbody id="sizeRangesTable">
                {% for size_range in size_ranges %}
                <tr data-id="{{ size_range.id }}" class="size-range-row">
                    <td>{{ size_range.name }}</td>
                    <td>{{ size_range.regular_sizes }}</td>
                    <td>{{ size_range.extended_sizes or 'N/A' }}</td>
                    <td>{{ "%.1f"|format(size_range.extended_markup_percent or 0) }}%</td>
                    <td>{{ size_range.description or '' }}</td>
                    <td>
                        <div class="actions">
                            <button class="btn btn-primary btn-small btn-edit" data-type="size_range" data-id="{{ size_range.id }}">Edit</button>
                            <button class="btn btn-danger btn-small btn-delete" data-type="size_range" data-id="{{ size_range.id }}">Delete</button>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>


        <!-- GLOBAL SETTINGS -->
        <h2>Global Settings</h2>
        <table>
            <thead>
                <tr>
                    <th>Setting</th>
                    <th>Value</th>
                    <th style="width: 150px;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for setting in global_settings %}
                <tr>
                    <td>{{ setting.setting_key }}</td>
                    <td>{{ setting.setting_value }}</td>
                    <td>
                        <div class="actions">
                            <button class="btn btn-primary btn-small btn-edit" data-type="global_setting" data-id="{{ setting.id }}">Edit</button>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="back-button">
            <a href="/" class="btn btn-secondary">‚Üê Back to Dashboard</a>
        </div>
    </div>

    <!-- Modal -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Add Item</h3>
            </div>
            <div id="modalBody"></div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="modalCancelBtn">Cancel</button>
                <button type="button" class="btn btn-primary" id="modalSaveBtn">Save</button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <!-- Data injection for JavaScript (JSON format - no linting errors) -->
     <!-- Data injection for JavaScript -->

      <script id="master-costs-data" type="application/json">
    {
        "fabricVendors": [
            {% for v in fabric_vendors %}
            {"id": {{ v.id }}, "name": {{ v.name|tojson }}}{% if not loop.last %},{% endif %}
            {% endfor %}
        ],
        "notionVendors": [
            {% for v in notion_vendors %}
            {"id": {{ v.id }}, "name": {{ v.name|tojson }}}{% if not loop.last %},{% endif %}
            {% endfor %}
        ]
    }
    </script>

    <!-- Load external JavaScript -->
    <script src="{{ url_for('static', filename='js/master_costs.js') }}"></script>
</body>
</html>