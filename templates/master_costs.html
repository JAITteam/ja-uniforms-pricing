{% extends "base.html" %}
{% block title %}Master Cost Lists | JA Uniforms{% endblock %}

{% block extra_css %}
<!-- Feather Icons -->
<script src="https://unpkg.com/feather-icons"></script>

<!-- Master Costs Styles -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/master_costs_styles.css') }}">
{% endblock %}

{% block content %}
    
    <!-- Main Container -->
    <div class="main-container">
        
        <!-- Header Section -->
        <header class="page-header">
            <div class="header-content">
                <div class="header-left">
                    <div class="page-icon">
                        <i data-feather="database"></i>
                    </div>
                    <div class="header-text">
                        <h1>Master Cost Lists</h1>
                        <p class="subtitle">Centralized pricing that automatically updates all uniform styles</p>
                    </div>
                </div>
                <div class="header-right">
                    <a href="/" class="btn-back">
                        <i data-feather="arrow-left"></i>
                        <span>Back to Dashboard</span>
                    </a>
                </div>
            </div>
            
            <!-- Warning Banner -->
            <div class="warning-banner">
                <i data-feather="alert-circle"></i>
                <span><strong>Important:</strong> Changes here will immediately affect pricing across all uniform styles in your system.</span>
            </div>
        </header>

        <!-- Vendors Grid -->
        <section class="section-card" id="fabric-vendors">
            <div class="section-header">
                <div class="section-title">
                    <i data-feather="users"></i>
                    <h2>Vendors</h2>
                </div>
            </div>
            
            <div class="vendors-grid">
                <!-- Fabric Vendors -->
                <div class="vendor-card" id="notion-vendors">
                    <div class="card-header gradient-red">
                        <div class="card-title">
                            <i data-feather="package"></i>
                            <h3>Fabric Vendors</h3>
                        </div>
                        <button class="btn-add" data-type="fabric_vendor">
                            <i data-feather="plus"></i>
                        </button>
                    </div>
                    <div class="table-container">
                        <table class="modern-table">
                            <thead>
                                <tr>
                                    <th data-sort="name">Name <i data-feather="chevrons-down" class="sort-icon"></i></th>
                                    <th data-sort="code">Code <i data-feather="chevrons-down" class="sort-icon"></i></th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for vendor in fabric_vendors %}
                                <tr data-id="{{ vendor.id }}">
                                    <td>{{ vendor.name }}</td>
                                    <td>{{ vendor.vendor_code or '' }}</td>
                                    <td class="actions-cell">
                                        <div class="row-actions">
                                            <button class="icon-btn icon-edit" data-type="fabric_vendor" data-id="{{ vendor.id }}" title="Edit">
                                                <i data-feather="edit-2"></i>
                                            </button>
                                            <button class="icon-btn icon-delete" data-type="fabric_vendor" data-id="{{ vendor.id }}" title="Delete">
                                                <i data-feather="trash-2"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Notion Vendors -->
                <div class="vendor-card">
                    <div class="card-header gradient-purple">
                        <div class="card-title">
                            <i data-feather="box"></i>
                            <h3>Notion Vendors</h3>
                        </div>
                        <button class="btn-add" data-type="notion_vendor">
                            <i data-feather="plus"></i>
                        </button>
                    </div>
                    <div class="table-container">
                        <table class="modern-table">
                            <thead>
                                <tr>
                                    <th data-sort="name">Name <i data-feather="chevrons-down" class="sort-icon"></i></th>
                                    <th data-sort="code">Code <i data-feather="chevrons-down" class="sort-icon"></i></th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for vendor in notion_vendors %}
                                <tr data-id="{{ vendor.id }}">
                                    <td>{{ vendor.name }}</td>
                                    <td>{{ vendor.vendor_code or '' }}</td>
                                    <td class="actions-cell">
                                        <div class="row-actions">
                                            <button class="icon-btn icon-edit" data-type="notion_vendor" data-id="{{ vendor.id }}" title="Edit">
                                                <i data-feather="edit-2"></i>
                                            </button>
                                            <button class="icon-btn icon-delete" data-type="notion_vendor" data-id="{{ vendor.id }}" title="Delete">
                                                <i data-feather="trash-2"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Fabrics Section -->
        <section class="section-card" id="fabrics-section">
            <div class="card-header gradient-blue">
                <div class="card-title">
                    <i data-feather="layers"></i>
                    <h2>Fabrics</h2>
                    <span class="item-count" id="fabricCount">{{ fabrics|length }} items</span>
                </div>
                <div class="header-actions">
                    <div class="search-box">
                        <i data-feather="search"></i>
                        <input type="text" id="fabricSearch" placeholder="Search fabrics..." autocomplete="off">
                    </div>
                    <button class="btn-add" data-type="fabric">
                        <i data-feather="plus"></i>
                        <span>Add Fabric</span>
                    </button>
                </div>
            </div>
            <div class="table-container scrollable">
                <table class="modern-table">
                    <thead>
                        <tr>
                            <th data-sort="name">Name <i data-feather="chevrons-down" class="sort-icon"></i></th>
                            <th data-sort="code">Fabric Code <i data-feather="chevrons-down" class="sort-icon"></i></th>
                            <th data-sort="cost">Cost/Yard <i data-feather="chevrons-down" class="sort-icon"></i></th>
                            <th data-sort="vendor">Vendor <i data-feather="chevrons-down" class="sort-icon"></i></th>
                        </tr>
                    </thead>
                    <tbody id="fabricTable">
                        {% for fabric in fabrics %}
                        <tr data-id="{{ fabric.id }}" class="fabric-row">
                            <td><strong>{{ fabric.name }}</strong></td>
                            <td><code>{{ fabric.fabric_code or '-' }}</code></td>
                            <td><span class="price">${{ "%.2f"|format(fabric.cost_per_yard) }}</span></td>
                            <td>{{ fabric.fabric_vendor.name if fabric.fabric_vendor else '-' }}</td>
                            <td class="actions-cell">
                                <div class="row-actions">
                                    <button class="icon-btn icon-edit" data-type="fabric" data-id="{{ fabric.id }}" title="Edit">
                                        <i data-feather="edit-2"></i>
                                    </button>
                                    <button class="icon-btn icon-delete" data-type="fabric" data-id="{{ fabric.id }}" title="Delete">
                                        <i data-feather="trash-2"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Notions Section -->
        <section class="section-card" id="notions-section">
            <div class="card-header gradient-purple">
                <div class="card-title">
                    <i data-feather="grid"></i>
                    <h2>Notions</h2>
                    <span class="item-count" id="notionCount">{{ notions|length }} items</span>
                </div>
                <div class="header-actions">
                    <div class="search-box">
                        <i data-feather="search"></i>
                        <input type="text" id="notionSearch" placeholder="Search notions..." autocomplete="off">
                    </div>
                    <button class="btn-add" data-type="notion">
                        <i data-feather="plus"></i>
                        <span>Add Notion</span>
                    </button>
                </div>
            </div>
            <div class="table-container scrollable">
                <table class="modern-table">
                    <thead>
                        <tr>
                            <th data-sort="name">Name <i data-feather="chevrons-down" class="sort-icon"></i></th>
                            <th data-sort="cost">Cost/Unit <i data-feather="chevrons-down" class="sort-icon"></i></th>
                            <th data-sort="unit">Unit Type <i data-feather="chevrons-down" class="sort-icon"></i></th>
                            <th data-sort="vendor">Vendor <i data-feather="chevrons-down" class="sort-icon"></i></th>
                        </tr>
                    </thead>
                    <tbody id="notionTable">
                        {% for notion in notions %}
                        <tr data-id="{{ notion.id }}" class="notion-row">
                            <td><strong>{{ notion.name }}</strong></td>
                            <td><span class="price">${{ "%.2f"|format(notion.cost_per_unit) }}</span></td>
                            <td><span class="badge">{{ notion.unit_type or 'each' }}</span></td>
                            <td>{{ notion.notion_vendor.name if notion.notion_vendor else '-' }}</td>
                            <td class="actions-cell">
                                <div class="row-actions">
                                    <button class="icon-btn icon-edit" data-type="notion" data-id="{{ notion.id }}" title="Edit">
                                        <i data-feather="edit-2"></i>
                                    </button>
                                    <button class="icon-btn icon-delete" data-type="notion" data-id="{{ notion.id }}" title="Delete">
                                        <i data-feather="trash-2"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Labor Operations Section -->
        <section class="section-card">
            <div class="card-header gradient-orange">
                <div class="card-title">
                    <i data-feather="tool"></i>
                    <h2>Labor Operations</h2>
                    <span class="item-count" id="laborCount">{{ labor_costs|length }} items</span>
                </div>
                <div class="header-actions">
                    <div class="search-box">
                        <i data-feather="search"></i>
                        <input type="text" id="laborSearch" placeholder="Search labor..." autocomplete="off">
                    </div>
                    <button class="btn-add" data-type="labor">
                        <i data-feather="plus"></i>
                        <span>Add Labor</span>
                    </button>
                </div>
            </div>
            <div class="table-container scrollable">
                <table class="modern-table">
                    <thead>
                        <tr>
                            <th data-sort="name">Name <i data-feather="chevrons-down" class="sort-icon"></i></th>
                            <th data-sort="type">Cost Type <i data-feather="chevrons-down" class="sort-icon"></i></th>
                            <th data-sort="rate">Rate <i data-feather="chevrons-down" class="sort-icon"></i></th>
                        </tr>
                    </thead>
                    <tbody id="laborTable">
                        {% for labor in labor_costs %}
                        <tr data-id="{{ labor.id }}" class="labor-row">
                            <td><strong>{{ labor.name }}</strong></td>
                            <td><span class="badge badge-{{ labor.cost_type }}">{{ labor.cost_type or 'flat_rate' }}</span></td>
                            <td>
                                {% if labor.cost_type == 'flat_rate' %}
                                    <span class="price">${{ "%.2f"|format(labor.fixed_cost or 0) }}</span>
                                {% elif labor.cost_type == 'hourly' %}
                                    <span class="price">${{ "%.2f"|format(labor.cost_per_hour or 0) }}/hr</span>
                                {% elif labor.cost_type == 'per_piece' %}
                                    <span class="price">${{ "%.2f"|format(labor.cost_per_piece or 0) }}/pc</span>
                                {% else %}
                                    <span class="text-muted">N/A</span>
                                {% endif %}
                            </td>
                            <td class="actions-cell">
                                <div class="row-actions">
                                    <button class="icon-btn icon-edit" data-type="labor" data-id="{{ labor.id }}" title="Edit">
                                        <i data-feather="edit-2"></i>
                                    </button>
                                    <button class="icon-btn icon-delete" data-type="labor" data-id="{{ labor.id }}" title="Delete">
                                        <i data-feather="trash-2"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Cleaning Costs Section -->
        <section class="section-card" >
            <div class="card-header gradient-green">
                <div class="card-title">
                    <i data-feather="droplet"></i>
                    <h2>Cleaning Costs</h2>
                    <span class="item-count" id="cleaningCount">{{ cleaning_costs|length }} items</span>
                </div>
                <div class="header-actions">
                    <div class="search-box">
                        <i data-feather="search"></i>
                        <input type="text" id="cleaningSearch" placeholder="Search cleaning..." autocomplete="off">
                    </div>
                    <button class="btn-add" data-type="cleaning">
                        <i data-feather="plus"></i>
                        <span>Add Cleaning</span>
                    </button>
                </div>
            </div>
            <div class="table-container scrollable">
                <table class="modern-table">
                    <thead>
                        <tr>
                            <th data-sort="type">Garment Type <i data-feather="chevrons-down" class="sort-icon"></i></th>
                            <th data-sort="cost">Cost <i data-feather="chevrons-down" class="sort-icon"></i></th>
                        </tr>
                    </thead>
                    <tbody id="cleaningTable">
                        {% for cleaning in cleaning_costs %}
                        <tr data-id="{{ cleaning.id }}" class="cleaning-row">
                            <td><strong>{{ cleaning.garment_type }}</strong></td>
                            <td><span class="price">${{ "%.2f"|format(cleaning.fixed_cost) }}</span></td>
                            <td class="actions-cell">
                                <div class="row-actions">
                                    <button class="icon-btn icon-edit" data-type="cleaning" data-id="{{ cleaning.id }}" title="Edit">
                                        <i data-feather="edit-2"></i>
                                    </button>
                                    <button class="icon-btn icon-delete" data-type="cleaning" data-id="{{ cleaning.id }}" title="Delete">
                                        <i data-feather="trash-2"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Colors Section -->
        <section class="section-card" id="colors-section">
            <div class="card-header gradient-pink">
                <div class="card-title">
                    <i data-feather="aperture"></i>
                    <h2>Colors</h2>
                    <span class="item-count" id="colorCount">{{ colors|length }} items</span>
                </div>
                <div class="header-actions">
                    <div class="search-box">
                        <i data-feather="search"></i>
                        <input type="text" id="colorSearch" placeholder="Search colors..." autocomplete="off">
                    </div>
                    <button class="btn-add" data-type="color">
                        <i data-feather="plus"></i>
                        <span>Add Color</span>
                    </button>
                </div>
            </div>
            <div class="table-container scrollable">
                <table class="modern-table">
                    <thead>
                        <tr>
                            <th data-sort="name">Color Name <i data-feather="chevrons-down" class="sort-icon"></i></th>
                        </tr>
                    </thead>
                    <tbody id="colorsTable">
                        {% for color in colors %}
                        <tr data-id="{{ color.id }}" class="color-row">
                            <td><strong>{{ color.name }}</strong></td>
                            <td class="actions-cell">
                                <div class="row-actions">
                                    <button class="icon-btn icon-edit" data-type="color" data-id="{{ color.id }}" title="Edit">
                                        <i data-feather="edit-2"></i>
                                    </button>
                                    <button class="icon-btn icon-delete" data-type="color" data-id="{{ color.id }}" title="Delete">
                                        <i data-feather="trash-2"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Variables Section -->
        <section class="section-card" id="variables-section">
            <div class="card-header gradient-cyan">
                <div class="card-title">
                    <i data-feather="tag"></i>
                    <h2>Variables</h2>
                    <span class="item-count" id="variableCount">{{ variables|length }} items</span>
                </div>
                <div class="header-actions">
                    <div class="search-box">
                        <i data-feather="search"></i>
                        <input type="text" id="variableSearch" placeholder="Search variables..." autocomplete="off">
                    </div>
                    <button class="btn-add" data-type="variable">
                        <i data-feather="plus"></i>
                        <span>Add Variable</span>
                    </button>
                </div>
            </div>
            <div class="table-container scrollable">
                <table class="modern-table">
                    <thead>
                        <tr>
                            <th data-sort="name">Variable Name <i data-feather="chevrons-down" class="sort-icon"></i></th>
                        </tr>
                    </thead>
                    <tbody id="variablesTable">
                        {% for variable in variables %}
                        <tr data-id="{{ variable.id }}" class="variable-row">
                            <td><strong>{{ variable.name }}</strong></td>
                            <td class="actions-cell">
                                <div class="row-actions">
                                    <button class="icon-btn icon-edit" data-type="variable" data-id="{{ variable.id }}" title="Edit">
                                        <i data-feather="edit-2"></i>
                                    </button>
                                    <button class="icon-btn icon-delete" data-type="variable" data-id="{{ variable.id }}" title="Delete">
                                        <i data-feather="trash-2"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Size Ranges Section -->
        <section class="section-card" id="size-ranges-section">
            <div class="card-header gradient-indigo">
                <div class="card-title">
                    <i data-feather="maximize-2"></i>
                    <h2>Size Ranges</h2>
                    <span class="item-count" id="sizeRangeCount">{{ size_ranges|length }} items</span>
                </div>
                <div class="header-actions">
                    <div class="search-box">
                        <i data-feather="search"></i>
                        <input type="text" id="sizeRangeSearch" placeholder="Search sizes..." autocomplete="off">
                    </div>
                    <button class="btn-add" data-type="size_range">
                        <i data-feather="plus"></i>
                        <span>Add Size Range</span>
                    </button>
                </div>
            </div>
            <div class="table-container scrollable">
                <table class="modern-table">
                    <thead>
                        <tr>
                            <th data-sort="name">Name <i data-feather="chevrons-down" class="sort-icon"></i></th>
                            <th data-sort="regular">Regular Sizes <i data-feather="chevrons-down" class="sort-icon"></i></th>
                            <th data-sort="extended">Extended Sizes <i data-feather="chevrons-down" class="sort-icon"></i></th>
                            <th data-sort="markup">Markup % <i data-feather="chevrons-down" class="sort-icon"></i></th>
                            <th data-sort="description">Description <i data-feather="chevrons-down" class="sort-icon"></i></th>
                        </tr>
                    </thead>
                    <tbody id="sizeRangesTable">
                        {% for size_range in size_ranges %}
                        <tr data-id="{{ size_range.id }}" class="size-range-row">
                            <td><strong>{{ size_range.name }}</strong></td>
                            <td><code>{{ size_range.regular_sizes }}</code></td>
                            <td><code>{{ size_range.extended_sizes or '-' }}</code></td>
                            <td><span class="badge">{{ "%.1f"|format(size_range.extended_markup_percent or 0) }}%</span></td>
                            <td><span class="text-muted">{{ size_range.description or '-' }}</span></td>
                            <td class="actions-cell">
                                <div class="row-actions">
                                    <button class="icon-btn icon-edit" data-type="size_range" data-id="{{ size_range.id }}" title="Edit">
                                        <i data-feather="edit-2"></i>
                                    </button>
                                    <button class="icon-btn icon-delete" data-type="size_range" data-id="{{ size_range.id }}" title="Delete">
                                        <i data-feather="trash-2"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Global Settings Section -->
        <section class="section-card" id="global-settings-section">
            <div class="card-header gradient-gray">
                <div class="card-title">
                    <i data-feather="settings"></i>
                    <h2>Global Settings</h2>
                    <span class="item-count">{{ global_settings|length }} items</span>
                </div>
            </div>
            <div class="table-container">
                <table class="modern-table">
                    <thead>
                        <tr>
                            <th data-sort="key">Setting <i data-feather="chevrons-down" class="sort-icon"></i></th>
                            <th data-sort="value">Value <i data-feather="chevrons-down" class="sort-icon"></i></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for setting in global_settings %}
                        <tr data-id="{{ setting.id }}">
                            <td><strong>{{ setting.setting_key }}</strong></td>
                            <td><span class="price">{{ setting.setting_value }}</span></td>
                            <td class="actions-cell">
                                <div class="row-actions">
                                    <button class="icon-btn icon-edit" data-type="global_setting" data-id="{{ setting.id }}" title="Edit">
                                        <i data-feather="edit-2"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>

    </div>

    <!-- Modal -->
    <div id="modal" class="modal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Add Item</h3>
                <button class="modal-close" onclick="closeModal()">
                    <i data-feather="x"></i>
                </button>
            </div>
            <div id="modalBody" class="modal-body"></div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="modalCancelBtn">Cancel</button>
                <button type="button" class="btn btn-primary" id="modalSaveBtn">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="notification" class="notification">
        <div class="notification-content">
            <i data-feather="check-circle"></i>
            <span id="notificationText">Success!</span>
        </div>
    </div>

    <!-- Data Injection -->
    <script id="master-costs-data" type="application/json">
    {
        "fabricVendors": [
            {% for v in fabric_vendors %}
            {"id": {{ v.id }}, "name": {{ v.name|tojson }}}{% if not loop.last %},{% endif %}
            {% endfor %}
        ],
        "notionVendors": [
            {% for v in notion_vendors %}
            {"id": {{ v.id }}, "name": {{ v.name|tojson }}}{% if not loop.last %},{% endif %}
            {% endfor %}
        ]
    }
    </script>

{% endblock %}

{% block extra_js %}
<!-- External JavaScript -->
<script src="{{ url_for('static', filename='js/master_costs.js') }}"></script>

<!-- Initialize Feather Icons -->
<script>
    feather.replace();
</script>
{% endblock %}