{% extends "base.html" %}
{% block title %}Style Cost Calculator - J.A Uniforms{% endblock %}
{% block content %}
{% if view_mode %}
<div style="background: #fef3c7; border: 2px solid #f59e0b; padding: 1rem; margin-bottom: 1.5rem; border-radius: 8px; text-align: center;">
    <strong style="color: #92400e;">üëÅÔ∏è VIEW ONLY MODE</strong>
    <span style="color: #a16207;"> - You can view this style but cannot make changes</span>
</div>
{% endif %}

<div class="toolbar">
  <div class="group">
    {% if not view_mode %}
    <button id="saveBtn" class="btn btn-primary btn-pill">
      <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
        <path d="M2 1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H9.5a1 1 0 0 0-1 1v7.293l2.646-2.647a.5.5 0 0 1 .708.708l-3.5 3.5a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L7.5 9.293V2a2 2 0 0 1 2-2H14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h2.5a.5.5 0 0 1 0 1H2z"/>
      </svg>
      Save Style
    </button>
    {% endif %}
    <button class="btn btn-outline-secondary btn-pill" onclick="exportCurrentStyle()">
      <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
        <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
        <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
      </svg>
      Export
    </button>
  </div>
  
  <div style="flex: 1; max-width: 400px; position: relative;">
    <input type="text" id="styleSearch" class="form-control" placeholder="Search by vendor style or name..." autocomplete="off">
    <div id="searchResults" style="position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #e5e5e5; border-top: none; max-height: 300px; overflow-y: auto; display: none; z-index: 1000;"></div>
  </div>
  
  <span class="chip">Works with /api/style (load & save)</span>
</div>

<div class="row g-3">
  <!-- LEFT: Main Editor (2 columns) -->
  <div class="col-lg-8">

    <!-- BASIC INFO PANEL -->
    <div class="panel">
      <div class="ph">BASIC INFO</div>
      <div class="pb">
        <div class="row g-3">
          <div class="col-lg-6">
            <div class="kv">
              <label>Vendor</label>
              <input id="vendor" class="form-control md" value="JA UNIFORMS" readonly>
            </div>
            <div class="kv">
              <label>Vendor Code</label>
              <input id="vendor_code" class="form-control xs" value="V999" readonly>
            </div>
            <div class="kv">
              <label>Base Item #</label>
              <input id="base_item_number" class="form-control xs">
              <label>Variant Code #</label>
              <input id="variant_code" class="form-control xs">
              <label>Fabric Code #</label>
              <input id="fabric_code" class="form-control xs" readonly>
            </div>
            <div class="kv">
              <label>Vendor Style</label>
              <input id="vendor_style" class="form-control lg" readonly>
            </div>
            <div class="kv">
              <label>Style name</label>
              <input id="style_name" class="form-control" placeholder="Enter style name" style="flex: 1;">
            </div>
            <div class="kv">
              <label>Gender</label>
              <select id="gender" class="form-select sm">
                <option value="">Select Gender</option>
                <option value="MENS">MENS</option>
                <option value="LADIES">LADIES</option>
                <option value="UNISEX">UNISEX</option>
              </select>
            </div>
          </div>
          
          <!-- ENHANCED IMAGE SECTION -->
          <div class="col-lg-6">
            <div class="image-section">
              <div id="imageGallery"></div>
              <input type="file" id="imageUpload" accept="image/png,image/jpeg,image/jpg,image/gif" multiple style="display: none;">
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- MATERIALS COST PANEL -->
    <div class="panel" id="materialsPanel">
      <div class="ph">MATERIALS COST</div>
      <div class="pb table-like">
        <!-- Fabric Row -->
        <div class="kv">
          <label>Vendor</label>
          <select class="form-select md" data-fabric-vendor-id>
            <option value="">Select Fabric Vendor</option>
            {% for v in fabric_vendors %}
            <option value="{{ v.id }}" data-fship="{{ v.f_ship_cost or 0 }}">{{ v.name }}</option>
            {% endfor %}
          </select>
          <label>Fabric</label>
          <select class="form-select md" data-fabric-id>
            <option value="">Select Fabric</option>
            <option value="__ADD_NEW__" style="color: #10b981; font-weight: 600;">+ Add New Fabric</option>
            {% for f in fabrics %}
            <option value="{{ f.id }}" data-cost="{{ f.cost_per_yard }}" data-vendor="{{ f.fabric_vendor_id }}" data-fabric-code="{{ f.fabric_code or '' }}">{{ f.name }}</option>
            {% endfor %}
          </select>
          
          <label style="display: flex; align-items: center; gap: 5px; white-space: nowrap;">
            <input type="checkbox" data-fabric-sublimation style="width: auto; margin: 0;">
            Sub.
          </label>
          
          <label>Avg.Cost/yd</label>
          <input class="form-control w-110 text-end" type="number" step="0.01" min="0" data-fabric-cost readonly>
          
          <label>Avg.Yds</label>
          <input class="form-control w-110 text-end" type="number" step="0.01" min="0" data-fabric-yds>

          <label>F.Ship</label>
          <input class="form-control text-end" type="number" step="0.01" min="0" data-fabric-fship readonly style="width: 70px;">
          
          <label>Total</label>
          <input class="form-control w-110 text-end" disabled data-fabric-total>
        </div>

        <div class="kv">
          <span class="linklike" id="addFabric">Fabric</span>
        </div>

        <!-- Notion Row -->
        <div class="kv">
          <label>Vendor</label>
          <select class="form-select md" data-notion-vendor-id>
            <option value="">Select Notion Vendor</option>
            {% for v in notion_vendors %}
            <option value="{{ v.id }}">{{ v.name }}</option>
            {% endfor %}
          </select>
        
          <label>Notion</label>
          <select class="form-select md" data-notion-id>
            <option value="">Select Notion</option>
            <option value="__ADD_NEW__" style="color: #10b981; font-weight: 600;">+ Add New Notion</option>
            {% for n in notions %}
            <option value="{{ n.id }}" data-cost="{{ n.cost_per_unit }}" data-vendor="{{ n.notion_vendor_id }}">{{ n.name }}</option>
            {% endfor %}
          </select>
          
          <label>Avg.Cost</label>
          <input class="form-control w-110 text-end" type="number" step="0.01" min="0" data-notion-cost readonly>
          
          <label>Qty</label>
          <input class="form-control qty text-end" type="number" step="0.01" min="0" data-notion-qty>
          
          <label>Total</label>
          <input class="form-control w-110 text-end" disabled data-notion-total>
        </div>

        <div class="kv">
          <span class="linklike" id="addNotion">Notion</span>
        </div>

        <div class="kv">
          <span class="text-muted">Avg. Label(s) Cost</span>
          <input class="form-control w-110 text-end" id="label_cost" type="number" step="0.01" min="0" value="{{ default_label_cost }}" readonly title="Edit in Master Costs">
        </div>

        <div class="sumline">
          <span>TOTAL MATERIALS COST</span>
          <strong id="sumMaterials">$0.00</strong>
        </div>
      </div>
    </div>

    <!-- LABOR COST PANEL -->
    <div class="panel" id="laborPanel">
      <div class="ph">LABOR COST</div>
      <div class="pb table-like" id="laborRows">
        {% for labor in labor_ops %}
        <div class="labor-row" data-labor-row data-labor-name="{{ labor.name }}">
          <span class="labor-name">{{ labor.name }}</span>
          <span class="labor-label">{% if labor.cost_type == 'hourly' %}Avg.Cost/Hr{% else %}Avg.Cost{% endif %}</span>
          <input class="form-control text-end" type="number" step="0.01" min="0"
                 value="{% if labor.cost_type == 'flat_rate' %}{{ labor.fixed_cost }}{% elif labor.cost_type == 'hourly' %}{{ labor.cost_per_hour }}{% else %}{{ labor.cost_per_piece }}{% endif %}" 
                 data-labor-rate readonly>
          <span class="labor-label">{% if labor.cost_type == 'hourly' %}Hours{% else %}Qty{% endif %}</span>
          <input class="form-control text-end" type="number" step="{% if labor.cost_type == 'hourly' %}0.01{% else %}1{% endif %}" min="0" data-labor-qoh>
          <span class="labor-label">Total</span>
          <input class="form-control text-end" disabled data-labor-total>
        </div>
        {% endfor %}

        <div class="labor-row labor-row-cleaning">
          <span class="labor-name">Cleaning & Ironing</span>
          <span class="labor-label">Type</span>
          <select class="form-select" id="garment_type">
            <option value="">Select Garment Type</option>
            {% for gt in garment_types %}
            <option value="{{ gt }}">{{ gt }}</option>
            {% endfor %}
          </select>
          <span class="labor-label">Total</span>
          <input class="form-control text-end" type="number" step="0.01" min="0" id="cleaning_cost" readonly>
        </div>

        <div class="sumline">
          <span>TOTAL LABOR COST</span>
          <strong id="sumLabor">$0.00</strong>
        </div>
      </div>
    </div>

    <!-- TOTAL COST PANEL -->
    <div class="panel">
      <div class="ph">TOTAL COST</div>
      <div class="pb">
        <div class="total-cost-row">
          <span class="total-cost-label">Size Range</span>
          <select class="form-select" id="size_range_id" style="width: 150px;">
            <option value="">Select Size Range</option>
            {% for sr in size_ranges %}
            <option value="{{ sr.id }}" 
                    data-name="{{ sr.name }}"
                    data-regular="{{ sr.regular_sizes }}" 
                    data-extended="{{ sr.extended_sizes }}"
                    data-markup="{{ sr.extended_markup_percent }}">
              {{ sr.name }}
            </option>
            {% endfor %}
          </select>
          <span class="chip">Regular Sizes</span>
          <input class="form-control text-center" id="regular_sizes_display" disabled style="width: 80px;">
          <span class="total-cost-label">Total Cost Price for Reg. Sizes</span>
          <input class="form-control text-end" id="total_reg" disabled style="width: 90px;">
        </div>
        <div class="total-cost-row">
          <span class="total-cost-label"></span>
          <span style="width: 150px;"></span>
          <span class="chip" id="extended_label">Extended Sizes (+15%)</span>
          <input class="form-control text-center" id="extended_sizes_display" disabled style="width: 80px;">
          <span class="total-cost-label">Total Cost Price for Ex. Sizes</span>
          <input class="form-control text-end" id="total_ext" disabled style="width: 90px;">
        </div>
      </div>
    </div>

    <!-- ADDITIONAL INFO PANEL -->
    <div class="panel">
      <div class="ph">ADDITIONAL INFO</div>
      <div class="pb">
        <div class="row g-3 mb-3">
          <!-- Colors Section -->
          <div class="col-md-6">
            <label class="form-label fw-bold" style="font-size: 0.875rem;">Color</label>
            <div class="d-flex gap-2 mb-2">
              <select id="color_dropdown" class="form-select" style="flex: 1;">
                <option value="">Select Color</option>
              </select>
              <button class="btn btn-primary btn-sm" type="button" onclick="addSelectedColor()">Add</button>
            </div>
            <select multiple class="form-select mb-2" style="height:120px" id="color_list"></select>
            <button class="btn btn-sm btn-danger" onclick="removeSelectedColors()">Remove Selected</button>
            <div class="input-group mt-2">
              <input id="new_color_input" class="form-control form-control-sm" placeholder="Or type new color...">
              <button class="btn btn-success btn-sm" type="button" onclick="addNewColor()">Create & Add</button>
            </div>
          </div>

          <!-- Variables Section -->
          <div class="col-md-6">
            <label class="form-label fw-bold" style="font-size: 0.875rem;">Variable</label>
            <div class="d-flex gap-2 mb-2">
              <select id="variable_dropdown" class="form-select" style="flex: 1;">
                <option value="">Select Variable</option>
              </select>
              <button class="btn btn-primary btn-sm" type="button" onclick="addSelectedVariable()">Add</button>
            </div>
            <select multiple class="form-select mb-2" style="height:120px" id="variable_list"></select>
            <button class="btn btn-sm btn-danger" onclick="removeSelectedVariables()">Remove Selected</button>
            <div class="input-group mt-2">
              <input id="new_variable_input" class="form-control form-control-sm" placeholder="Or type new variable...">
              <button class="btn btn-success btn-sm" type="button" onclick="addNewVariable()">Create & Add</button>
            </div>
          </div>
        </div>

        <!-- Pricing Section - ULTRA COMPACT -->
        <div class="kv mb-3" style="background: #f8f9fa; padding: 0.5rem 0.75rem; border-radius: 4px;">
          <strong style="font-size: 0.8rem; color: #555;">Pricing:</strong>

          <span style="font-size: 0.75rem; color: #888;">(Estimate:</span>
          <input id="margin" class="form-control text-end" type="number" step="1" value="60" min="0" max="95" style="width: 55px; padding: 0.2rem 0.4rem; font-size: 0.8rem;">
          <span style="font-size: 0.75rem; color: #888;">%</span>
          <span style="margin: 0 0.3rem; color: #999; font-size: 0.75rem;">=</span>
          <input id="retail_price" class="form-control text-end" disabled style="width: 75px; padding: 0.2rem 0.4rem; background: white; font-size: 0.8rem; color: #888;">
          <span style="font-size: 0.75rem; color: #888;">)</span>

          <span style="margin: 0 0.75rem; color: #ddd;">|</span>

          <span style="font-size: 0.75rem; color: #333; font-weight: 600;">MARGIN</span>
          <input id="suggested_margin" class="form-control text-end" type="number" step="0.1" min="0" max="95" style="width: 60px; padding: 0.2rem 0.4rem; font-size: 0.8rem;">
          <span style="font-size: 0.75rem; color: #333;">%</span>

          <span style="margin: 0 0.3rem; color: #999; font-size: 0.75rem;">‚Üí</span>

          <span style="font-size: 0.75rem; color: #333; font-weight: 600;">SALE PRICE</span>
          <input id="suggested_price" class="form-control text-end" type="number" step="0.01" min="0" style="width: 80px; padding: 0.2rem 0.4rem; font-size: 0.8rem; font-weight: 600; background: #f8f9fa;" readonly>
        </div>
        
        <div class="kv mb-3">
          <span class="text-muted">Shipping Cost</span>
          <input id="shipping_cost" class="form-control w-110 text-end" type="number" step="0.01" min="0" value="{{ default_shipping_cost }}" readonly title="Edit in Master Costs">
        </div>
        
        <div>
          <label class="form-label fw-bold" style="font-size: 0.875rem;">Notes</label>
          <textarea id="notes" class="form-control" rows="4" placeholder="Additional notes, special instructions, or details about this style..."></textarea>
        </div>
      </div>
    </div>

  </div>

  <!-- RIGHT: Snapshot Panel (1 column) - STICKY ON RIGHT -->
  <div class="col-lg-4">
    <div class="right-sticky panel snapshot">
      <div class="ph">SNAPSHOT</div>
      <div class="pb">
        <div class="mb-3">
          <strong id="snap_vendor_style" class="d-block">(vendor style)</strong>
          <span id="snap_style" class="text-muted small"></span>
        </div>
        <div class="sumline">
          <span>Materials</span>
          <strong id="snap_mat">$0.00</strong>
        </div>
        <div class="sumline">
          <span>Labor</span>
          <strong id="snap_lab">$0.00</strong>
        </div>
        <div class="sumline">
          <span>Shipping</span>
          <strong id="snap_ship">$0.00</strong>
        </div>
        <hr>
        <div class="sumline">
          <span>TOTAL COST</span>
          <strong id="snap_total" style="font-size: 1.5rem;">$0.00</strong>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Image Zoom Modal -->
<div id="imageModal" class="image-modal">
  <span class="close-modal" onclick="closeImageModal()">&times;</span>
  <img id="modalImage" src="" alt="Zoomed image">
</div>

<script>
// Global sublimation cost from settings
window.SUBLIMATION_COST = parseFloat("{{ default_sublimation_cost }}") || 6.00;
// Export current style to SAP B1 format
function exportCurrentStyle() {
    // ========================================
    // EXPORT VALIDATION - 4 REQUIREMENTS
    // ========================================
    
    const vendorStyle = document.getElementById('vendor_style')?.value.trim();
    const styleName = document.getElementById('style_name')?.value.trim();
    
    // Build error message for missing requirements
    const missing = [];
    
    // 1. Vendor Style
    if (!vendorStyle) {
        missing.push('‚Ä¢ VENDOR STYLE (Base Item #)');
    }
    
    // 2. Style Name
    if (!styleName) {
        missing.push('‚Ä¢ STYLE NAME');
    }
    
    // 3. At least one COLOR
    const colorList = document.getElementById('color_list');
    const hasColors = colorList && colorList.options.length > 0;
    if (!hasColors) {
        missing.push('‚Ä¢ At least ONE COLOR');
    }
    
    // 4. Size Range selected
    const sizeRange = document.getElementById('size_range_id');
    const hasSizeRange = sizeRange && sizeRange.value;
    if (!hasSizeRange) {
        missing.push('‚Ä¢ SIZE RANGE');
    }
    
    // Show error if anything is missing
    if (missing.length > 0) {
        alert('‚ö†Ô∏è Cannot export! Missing required fields:\n\n' + missing.join('\n') + '\n\nPlease complete these fields and SAVE the style first.');
        
        // Focus on first missing field
        if (!vendorStyle) {
            document.getElementById('base_item_number')?.focus();
        } else if (!styleName) {
            document.getElementById('style_name')?.focus();
        } else if (!hasColors) {
            document.getElementById('color_dropdown')?.focus();
        } else if (!hasSizeRange) {
            document.getElementById('size_range_id')?.focus();
        }
        
        return;
    }
    
    // Check if style is saved (has URL parameter)
    const urlParams = new URLSearchParams(window.location.search);
    const currentVendorStyle = urlParams.get('vendor_style');
    
    if (!currentVendorStyle) {
        alert('‚ö†Ô∏è Style not saved yet!\n\nPlease click "Save Style" button first, then try exporting again.');
        return;
    }
    
    // Verify the saved vendor_style matches current vendor_style
    if (currentVendorStyle !== vendorStyle) {
        alert('‚ö†Ô∏è Style has been modified!\n\nPlease SAVE the style again before exporting.');
        return;
    }
    
    // ========================================
    // PROCEED WITH EXPORT
    // ========================================
    
    // Get CSRF token
    const csrfToken = document.querySelector('meta[name="csrf-token"]')?.getAttribute('content');
    
    if (!csrfToken) {
        alert('‚ùå Security token not found. Please refresh the page and try again.');
        return;
    }
    
    // Create a form and submit to the export endpoint
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = '/export-sap-single-style';
    
    // Add CSRF token
    const csrfInput = document.createElement('input');
    csrfInput.type = 'hidden';
    csrfInput.name = 'csrf_token';
    csrfInput.value = csrfToken;
    form.appendChild(csrfInput);
    
    // Add vendor_style as form data
    const input = document.createElement('input');
    input.type = 'hidden';
    input.name = 'vendor_style';
    input.value = currentVendorStyle;
    form.appendChild(input);
    
    document.body.appendChild(form);
    form.submit();
    document.body.removeChild(form);
}

</script>
{% if view_mode %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Function to disable all form elements
    function disableAllInputs() {
        document.querySelectorAll('input, select, textarea').forEach(function(el) {
            el.disabled = true;
            el.style.backgroundColor = '#f3f4f6';
            el.style.cursor = 'not-allowed';
        });
    }
    
    // Initial disable
    disableAllInputs();
    
    // Hide all add/remove buttons
    document.querySelectorAll('button').forEach(function(el) {
        var text = el.textContent.toLowerCase();
        if (text.includes('add') || text.includes('remove') || text.includes('delete')) {
            el.style.display = 'none';
        }
    });
    
    // Hide add links
    document.querySelectorAll('.linklike').forEach(function(el) {
        el.style.display = 'none';
    });
    
    // Disable image upload
    var imageUpload = document.getElementById('imageUpload');
    if (imageUpload) imageUpload.disabled = true;
    
    var addImageBox = document.getElementById('addImageBox');
    if (addImageBox) addImageBox.style.display = 'none';
    
    // Watch for dynamically added rows and disable them too
    const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            mutation.addedNodes.forEach(function(node) {
                if (node.nodeType === 1) { // Element node
                    // Disable any inputs in the new node
                    node.querySelectorAll?.('input, select, textarea').forEach(function(el) {
                        el.disabled = true;
                        el.style.backgroundColor = '#f3f4f6';
                        el.style.cursor = 'not-allowed';
                    });
                    // Hide remove buttons
                    node.querySelectorAll?.('button').forEach(function(el) {
                        if (el.textContent.toLowerCase().includes('remove')) {
                            el.style.display = 'none';
                        }
                    });
                }
            });
        });
    });
    
    // Observe the materials panel for changes
    const materialsPanel = document.getElementById('materialsPanel');
    if (materialsPanel) {
        observer.observe(materialsPanel, { childList: true, subtree: true });
    }
    
    console.log('View mode enabled - all inputs disabled');
});
</script>
{% endif %}

<!-- Quick Add Fabric Modal -->
<div id="quickAddFabricModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; align-items: center; justify-content: center;">
  <div style="background: white; padding: 2rem; border-radius: 12px; width: 400px; max-width: 90%;">
    <h3 style="margin: 0 0 1.5rem 0; color: #1e293b;">Add New Fabric</h3>
    
    <div style="margin-bottom: 1rem;">
      <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Fabric Name *</label>
      <input type="text" id="quick_fabric_name" class="form-control" placeholder="e.g., XANADU" style="width: 100%;">
    </div>
    
    <div style="margin-bottom: 1rem;">
      <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Fabric Code *</label>
      <input type="text" id="quick_fabric_code" class="form-control" placeholder="e.g., T1" style="width: 100%;">
    </div>
    
    <div style="margin-bottom: 1rem;">
      <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Cost per Yard *</label>
      <input type="number" id="quick_fabric_cost" class="form-control" step="0.01" min="0" placeholder="e.g., 6.50" style="width: 100%;">
    </div>
    
    <div style="margin-bottom: 1.5rem;">
      <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Vendor *</label>
      <select id="quick_fabric_vendor" class="form-select" style="width: 100%;">
        <option value="">Select Vendor</option>
        {% for v in fabric_vendors %}
        <option value="{{ v.id }}">{{ v.name }}</option>
        {% endfor %}
      </select>
    </div>
    
    <div style="display: flex; gap: 1rem; justify-content: flex-end;">
      <button type="button" onclick="closeQuickAddFabric()" style="padding: 0.5rem 1rem; border: 1px solid #ddd; background: white; border-radius: 6px; cursor: pointer;">Cancel</button>
      <button type="button" onclick="saveQuickFabric()" style="padding: 0.5rem 1rem; border: none; background: #10b981; color: white; border-radius: 6px; cursor: pointer; font-weight: 600;">Save Fabric</button>
    </div>
  </div>
</div>

<!-- Quick Add Notion Modal -->
<div id="quickAddNotionModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; align-items: center; justify-content: center;">
  <div style="background: white; padding: 2rem; border-radius: 12px; width: 400px; max-width: 90%;">
    <h3 style="margin: 0 0 1.5rem 0; color: #1e293b;">Add New Notion</h3>
    
    <div style="margin-bottom: 1rem;">
      <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Notion Name *</label>
      <input type="text" id="quick_notion_name" class="form-control" placeholder="e.g., 18L SPORT BUTTON" style="width: 100%;">
    </div>
    
    <div style="margin-bottom: 1rem;">
      <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Cost per Unit *</label>
      <input type="number" id="quick_notion_cost" class="form-control" step="0.01" min="0" placeholder="e.g., 0.15" style="width: 100%;">
    </div>
    
    <div style="margin-bottom: 1.5rem;">
      <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Vendor *</label>
      <select id="quick_notion_vendor" class="form-select" style="width: 100%;">
        <option value="">Select Vendor</option>
        {% for v in notion_vendors %}
        <option value="{{ v.id }}">{{ v.name }}</option>
        {% endfor %}
      </select>
    </div>
    
    <div style="display: flex; gap: 1rem; justify-content: flex-end;">
      <button type="button" onclick="closeQuickAddNotion()" style="padding: 0.5rem 1rem; border: 1px solid #ddd; background: white; border-radius: 6px; cursor: pointer;">Cancel</button>
      <button type="button" onclick="saveQuickNotion()" style="padding: 0.5rem 1rem; border: none; background: #10b981; color: white; border-radius: 6px; cursor: pointer; font-weight: 600;">Save Notion</button>
    </div>
  </div>
</div>

{% endblock %}

